#searched online for resources to obtain the whole genome of Drosophila melanogaster and RNA-Seq reads from the SRA
#obtained and downloaded the whole genome and gtf files from the flybase.net: ftp://ftp.flybase.net/genomes/dmel/current/fasta/
#and ftp://ftp.flybase.net/genomes/dmel/current/gtf/
#obtained and downloaded the RNA-Seq reads from the SRA: https://www.ncbi.nlm.nih.gov/sra/SRX5664975[accn]?report=Full

#unzip the whole genome
gunzip gunzip dmel-all-gene-r6.27.fasta.gz

#unzip the gtf file
gunzip dmel-all-r6.27.gtf.gz

wget -c ftp://ftp-trace.ncbi.nih.gov/sra/sra-instant/reads/ByRun/sra/SRR/SRR887/SRR8878057/SRR8878057.sra
sudo apt install sra-toolkit

#convert the reads file from sra to fastq
fastq-dump SRR8878057.sra

#make a directory to have all files for the project
mkdir NGS_Proj

#copy the files needed from their destination to the new directory
cp dmel-all-gene-r6.27.fasta /home/NGS_Proj
cp dmel-all-r6.27.gtf /home/elshaimaa/NGS_Proj/
cp SRR8878057.fastq /home/elshaimaa/NGS_Proj

#check the quality of reads obtained
fastqc -t 1 -f fastq -noextract SRR8878057.fastq

#index the genome
mkdir -p ~/NGS_Proj/hisat_align/hisat_index && cd ~/NGS_Proj/hisat_align/hisat_index
ln -s ~/NGS_Proj/dmel-all-gene-r6.27.fasta .
ln -s ~/NGS_Proj/SRR8878057.fastq .
ln -s ~/NGS_Proj/dmel-all-r6.27.gtf
hisat2_extract_splice_sites.py ~/NGS_Proj/dmel-all-r6.27.gtf > splicesites.tsv
hisat2_extract_exons.py ~/NGS_Proj/dmel-all-r6.27.gtf > exons.tsv
hisat2-build -p 1 --ss splicesites.tsv --exon exons.tsv dmel-all-gene-r6.27.fasta dmel-all-gene-r6.27

#alignment
cd NGS_Proj/hisat_align/
hisat2 -p 1 -x hisat_index/dmel-all-gene-r6.27.fasta --dta --rna-strandness F hisat_index/SRR8878057.fastq -S SRR8878057.sam

#file preparation for assembly
cd ..
sudo apt install bamtools
cd hisat_align/
samtools view -b SRR8878057.sam > SRR8878057.bam
samtools sort SRR8878057.bam -o SRR8878057.sorted.bam



